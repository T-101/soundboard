{% extends 'soundboard/base.html' %}

{% block title %}
    <title>{{ object }} | Soundboard</title>
    <meta property="og:title" content="{{ object }} | Soundboard"/>
{% endblock %}

{% block content %}

    <div class="container">
        <h3 class="mb-4">{{ object }} Soundboard</h3>
        <div class="form-check form-switch mb-4">
            <input class="form-check-input" type="checkbox" role="switch" id="loopCheckBox"
            style="scale: 2; margin: 10px 25px 0 -25px;">
            <label class="form-check-label" for="loopCheckBox" style="font-size: 20px;">Loop</label>
        </div>

        {% for sound in object.sounds.all %}
            <button class="btn btn-primary btn-lg soundButton mb-2" data-sound-src="{{ sound.sound.url }}">
                <i class="fa-solid fa-play me-2" style="width: 20px"></i>{{ sound.name }}</button>
        {% endfor %}
    </div>

    <audio id="audio_player"></audio>

    <script>
        const
            audioPlayer = document.querySelector("#audio_player"),
            loopCheckBox = document.querySelector("#loopCheckBox"),
            soundButtons = document.querySelectorAll(".soundButton")

        clearIcons = () => {
            soundButtons.forEach(button => button.firstElementChild.classList.replace("fa-pause", "fa-play"))
        }

        soundButtons.forEach(button => button.addEventListener("click", (e) => {
            const target = e.target.tagName === "I" ? e.target.parentElement : e.target
            if (target.firstElementChild.classList.contains("fa-pause")) {
                audioPlayer.pause()
                return target.firstElementChild.classList.replace("fa-pause", "fa-play")
            }
            clearIcons()
            target.firstElementChild.classList.replace("fa-play", "fa-pause")
            audioPlayer.src = target.dataset.soundSrc
            audioPlayer.play()
        }))

        loopCheckBox.addEventListener("click", e => audioPlayer.loop = e.target.checked)

        audioPlayer.addEventListener('ended', clearIcons)

    </script>

{% endblock %}
