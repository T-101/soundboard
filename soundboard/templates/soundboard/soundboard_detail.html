{% extends 'soundboard/base.html' %}

{% block title %}
    <title>{{ object }} | Soundboard.didnot.win</title>
{% endblock %}

{% block content %}

    <div class="container">
        <h3 class="headerTitle">{{ object }} Soundboard</h3>
        <div class="form-check form-switch mb-4">
            <input class="form-check-input" type="checkbox" role="switch" id="loopCheckBox">
            <label class="form-check-label" for="flexSwitchCheckDefault">Loop</label>
        </div>

        {% for sound in object.sounds.all %}
            <button class="btn btn-primary btn-lg soundButton mb-2" id="sound_{{ forloop.counter0 }}">
                <i class="fa-solid fa-play me-2" style="width: 20px"></i>{{ sound.name }}</button>
        {% endfor %}
    </div>

    <audio id="audio_player"></audio>

    <script>
        const sounds = [
            {% for sound in object.sounds.all %}
                "{{ sound.sound.url }}",
            {% endfor %}
        ]

        const audioPlayer = document.querySelector("#audio_player")

        clearIcons = () => {
            document.querySelectorAll(".soundButton").forEach((elem) => {
                elem.firstElementChild.classList.replace("fa-pause", "fa-play")
            })
        }

        document.addEventListener("DOMContentLoaded", function (event) {
            $(".soundButton").click((e) => {
                const target = e.target.tagName === "I" ? e.target.parentElement : e.target
                if (target.firstElementChild.classList.contains("fa-pause")) {
                    audioPlayer.pause()
                    target.firstElementChild.classList.replace("fa-pause", "fa-play")
                    return
                }
                clearIcons()
                const soundId = target.id.split("_")[1]
                target.firstElementChild.classList.replace("fa-play", "fa-pause")
                audioPlayer.src = sounds[soundId]
                audioPlayer.play()
            })

            $("#loopCheckBox").click((e) => {
                audioPlayer.loop = e.target.checked
            })

            audioPlayer.addEventListener('ended', (event) => {
                clearIcons()
            })
        });

    </script>

{% endblock %}
